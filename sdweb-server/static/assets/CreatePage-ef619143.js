import{_ as D,E as C,S,r,o as f,b as y,a as t,w as n,f as I,t as w,c as v,e as h,p as P,h as x,F as R}from"./index-83b16cf2.js";import{_ as z,A as k,D as F}from"./DialogShowImage-9bbe4c8a.js";import G from"./RandomTagDialog-714480ef.js";import E from"./Login-cb2f9ad2.js";import M from"./Go-e91e4182.js";import"./ImageSize-c8b7883a.js";const b=S+"/api/readImage?id=";let a={prompt:"",negative_prompt:"",seed:0,step:0,imageBatchCount:0,imageBatchSize:0,sizew:0,sizeh:0,hires_upscale:1},p={};const N={data(){return{createImagesBtnTxt:"Generate(生成)",createImagesBtnType:"warning",createImagesBtnDisabled:!1,createRunning:!1,randomPrompt:!0}},created(){this.$bus1.on("generateBtnReset",e=>{this.resetButton()}),this.$bus1.on("generateDialogToImages",e=>{a.prompt=e.prompt,this.createImages()})},setup(e){},mounted:function(){},methods:{createSubmit(){if(this.$bus1.emit("getPromptInfo",(e,s,i)=>{a.prompt=e,a.negative_prompt=s,this.randomPrompt=i}),this.createRunning){this.interrupt();return}this.randomPrompt?this.$bus1.emit("showRandomTagDialog",{}):this.createImages()},interrupt(){this.createImagesBtnTxt="停止中...",this.$myFetch("/api/interrupt","POST",null).then(e=>{this.resetButton(),this.$bus1.emit("generateDialogProcessDestroy")})},createImages(){if(a={},this.$bus1.emit("createSeedRandom",{}),this.$bus1.emit("getAdvancedInfo",(e,s,i,c,o,l)=>{a.seed=e,a.step=s,a.imageBatchCount=i,a.imageBatchSize=c,a.cfgScale=o,a.samplerIndex=l}),this.$bus1.emit("getImageSize",(e,s,i)=>{a.sizew=e,a.sizeh=s,a.upscaleB=i}),this.$bus1.emit("getPromptInfo",(e,s,i)=>{a.prompt=e,a.negative_prompt=s,this.randomPrompt=i}),a.prompt==""&&this.randomPrompt){C.alert("绘画内容描述中-希望出现的内容没有填写-No input prompt","有内容没填写-No input prompt",{confirmButtonText:"OK",callback:()=>{this.$bus1.emit("setElCollapseExpand",{})}});return}this.createImgData=null,this.seedRandomCheck&&this.seedNumMake(),this.createImagesBtnTxt="Stop(终止)",this.createImagesBtnType="info",this.createRunning=!0,this.$bus1.emit("getModelInfoSelected",function(e){p=e}),p!=null&&p.title!=""&&this.switchModel(p.title),this.$bus1.emit("generateDialogShowHidden",{show:!0}),this.$myFetch("/api/create","POST",a).then(e=>{if(this.createRunning!=!1){this.$bus1.emit("generateDialogProcessDestroy",{}),e.sub_seed_path.length==1,this.$bus1.emit("generateDialogDone",{processCount:100,imageUrl:b+e.sub_seed_path[0].image_tag_md5_id+"&t=4"});for(let s=0;s<e.sub_seed_path.length;s++){let i=b+e.sub_seed_path[s].image_tag_md5_id+"&t=4";this.$bus1.emit("generateDialogPushSrcList",{imageUrl:i});let c={};Object.assign(c,a),c.seed=e.seed,c.image_tag_md5_id=e.sub_seed_path[s].image_tag_md5_id,c.star=0,this.$bus1.emit("addImagesFirst",{createImgData:c,url:i}),e.seed!=-200}this.resetButton()}}).catch(e=>{this.resetButton(),this.$bus1.emit("generateDialogProcessDestroy"),console.log(e),console.log(".................................................................."),this.$message.error("创建绘画失败,可能相关图画描述及种子图已存在,请查看历史生成图")})},switchModel(e){let s={modelId:e};this.$myFetch(S+"/api/changeModel","POST",s).then(i=>{})},resetButton(){this.createImagesBtnTxt="Generate(生成)",this.createImagesBtnType="warning",this.createImagesBtnDisabled=!1,this.createRunning=!1}}},L={class:"demonstration",style:{"line-height":"30pt"}};function O(e,s,i,c,o,l){const m=r("el-button");return f(),y("span",L,[t(m,{type:o.createImagesBtnType,size:e.large,disabled:o.createImagesBtnDisabled,onClick:l.createSubmit,style:{height:"50px",width:"150px"}},{default:n(()=>[I(w(o.createImagesBtnTxt),1)]),_:1},8,["type","size","disabled","onClick"])])}const V=D(N,[["render",O]]);const A=e=>e===100?"完成":`${e}%`,U=e=>{},j={data(){return{createImageDialog:!1,createImageDialogType:"ttb",handleCloseCreateImage:U,processTabFormat:A,processCount:100,createImageCloseBtn:!1,createRunning:!1,generateImageSrc:"",generateImageSrcList:[],processTimer:null}},created(){},setup(e){},mounted:function(){this.$bus1.on("generateDialogShowHidden",e=>{e.show?(this.createImageDialog=!0,this.processCount=0,this.processStart()):(this.createImageDialog=!1,this.processDestroy())}),this.$bus1.on("generateDialogPushSrcList",e=>{this.generateImageSrcList.push(e.imageUrl)}),this.$bus1.on("generateDialogDone",e=>{this.processCount=e.processCount,this.generateImageSrc=e.imageUrl}),this.$bus1.on("generateDialogProcessDestroy",e=>{this.processDestroy()})},methods:{processGet(){this.createRunning||(this.createRunning=!0,this.$myFetch("/api/process","POST",null).then(e=>{this.createRunning=!1,e.eta_relative>0?(console.log("activeactiveactive"),this.processCount=parseInt(e.progress*100),this.generateImageSrc="data:image/png;base64,"+e.current_image):this.processDestroy()}).catch(e=>{console.log(e),this.processDestroy()}))},processStart(){this.generateImageSrcList=[],this.generateImageSrc="",this.processDestroy(),this.processTimer=setInterval(()=>{this.processGet()},1e3)},processDestroy(){this.createRunning=!1,clearInterval(this.processTimer),this.processTimer=null},closeDialog(){this.createImageDialog=!1,this.processDestroy()}}},H=e=>(P("data-v-a4ba8163"),e=e(),x(),e),K=H(()=>h("span",null,"请稍等..",-1)),q={class:"image-slot"};function J(e,s,i,c,o,l){const m=r("icon-picture"),g=r("el-icon"),u=r("el-image"),_=r("el-progress"),d=r("el-button"),B=r("el-drawer");return f(),v(B,{modelValue:o.createImageDialog,"onUpdate:modelValue":s[0]||(s[0]=T=>o.createImageDialog=T),size:"70%",title:"正在生成中...",direction:o.createImageDialogType},{default:n(()=>[K,t(u,{style:{width:"70%",height:"70%"},src:o.generateImageSrc,"zoom-rate":1.7,"preview-src-list":o.generateImageSrcList,"initial-index":4,fit:"contain"},{error:n(()=>[h("div",q,[t(g,null,{default:n(()=>[t(m)]),_:1})])]),_:1},8,["src","zoom-rate","preview-src-list"]),t(_,{class:"progresscss",percentage:o.processCount,format:o.processTabFormat},null,8,["percentage","format"]),t(d,{type:"primary",style:{"margin-left":"16px",cursor:"pointer"},onClick:l.closeDialog,size:"large"},{default:n(()=>[I("关闭")]),_:1},8,["onClick"])]),_:1},8,["modelValue","direction"])}const Q=D(j,[["render",J],["__scopeId","data-v-a4ba8163"]]);const W={class:"container"},X=h("div",{class:"logo-1"}," AI绘图 ",-1),$=e=>`还剩${e}%图片未浏览`,Y={data(){return{isCollapse:!1,processCount:100,duration:5,pageTotal:100,pageSize:10,processTabFormat:$,page:1}},mounted:function(){this.setPage(),this.$bus1.on("setPageProgress",e=>{this.processCount=(100-e.pageNum/e.totalSize*100).toFixed(2)})},methods:{setPage(){},handleSelect(e){this.$router.push(e)}}},re=Object.assign(Y,{__name:"CreatePage",setup(e){return(s,i)=>{const c=r("el-header"),o=r("el-aside"),l=r("el-backtop"),m=r("el-main"),g=r("el-col"),u=r("el-progress"),_=r("el-row"),d=r("el-footer");return f(),y(R,null,[t(E),h("div",W,[t(c,{class:"header"},{default:n(()=>[X]),_:1}),t(o,{class:"aside"},{default:n(()=>[t(z),t(M)]),_:1}),t(m,{class:"main"},{default:n(()=>[t(l,{bottom:100,target:".el-main","visibility-height":200},{default:n(()=>[I(" 返回顶部 ")]),_:1}),t(k),t(F)]),_:1}),t(d,{class:"footer"},{default:n(()=>[t(_,{gutter:16},{default:n(()=>[t(g,{span:7},{default:n(()=>[t(o,null,{default:n(()=>[t(V),t(Q)]),_:1})]),_:1}),t(g,{span:7},{default:n(()=>[t(u,{percentage:s.processCount,"stroke-width":12,striped:"","striped-flow":"",duration:s.duration,format:$,color:"#e6a23c"},null,8,["percentage","duration"])]),_:1}),t(g,{span:3,class:"versioninfo"})]),_:1})]),_:1})]),t(G)],64)}}});export{re as default};
